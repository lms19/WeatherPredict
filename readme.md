# 基于LSTM和ARIMA模型的天气预测和比较

## 1 实验环境
语言：Python   
解释器：Python 3.10  
python 包：

```
joblib=1.1.0
statsmodels=0.13.2
matplotlib=3.5.1
seaborn=0.11.2
scipy=1.8.0
scikit-learn=1.0.2
tensorflow=2.9.1
pandas=1.4.3
numpy=1.22.3
beautifulsoup4=4.11.1
urllib3=1.26.11
```
测试本程序的时候请尽可能安装不低于上述版本的Python包。


## 2 项目说明

本项目主要由两部分组成：LSTM、ARIMA模型拟合效果比较，和基于两个模型的天气预测预报系统（GUI）界面  \
本项目各文件的说明如下：

`main1.py`: 模型比较的入口 \
`main2.py`: 天气预报系统的入口 \
`data_get.py`: 爬虫获取天气数据，构建数据集 \
`data_load.py`: 读取数据集中的数据，数据清洗，可视化原始数据，原始数据白噪声检验 \
`arima.py`: ARIMA模型的实现，包括p,d,q参数的选择、ADF检验和白噪声检验、ARIMA模型自动选择和手动选择  \
`lstm.py`: LSTM模型的实现，包括数据的处理，LSTM网络的生成和拟合，loss曲线的绘制  \
`model_analyze.py`:模型拟合效果评价，包括残差序列检验（残差图、残差直方密度图、QQ图、ACF图）、模型准确性评价、拟合图\
`handle.py`: 天气预报系统的数据获取 \
`dataset`: 文件夹，储存各城市天气数据集 \
`model`: 文件夹，储存各城市天气数据拟合模型，其中h5文件为LSTM模型， pkl文件为ARIMA模型


## 3 模型比较
__示例：__ 直接运行`main1.py`文件，或将本程序在终端中打开，输入
```
python main1.py
```
可进行模型比较，将依次进行：\
LSTM模型拟合(可跳过) -> 绘制loss曲线(随上一步跳过) -> 
绘制LSTM拟合曲线 -> 绘制LSTM模型残差折线图、密度图、QQ图、ACF图、打印白噪声检验结果 -> 打印LSTM模型准确性评价指标

![](picture/lstm1.png#pic_center)
![](picture/lstm2.png#pic_center)
```
LSTM:  {'MSE': 3.809351612077138, 'RMSE': 1.9517560329296122, 'MAE': 1.3407798945997853, 'MAPE': 0.06877151237127875}
```

-> 绘制差分图 -> 绘制ACF PACF图 -> ARIMA模型拟合(可跳过) -> 打印ARIMA模型参数 ->
绘制ARIMA拟合曲线 -> 绘制ARIMA模型残差折线图、密度图、QQ图、ACF图、
打印白噪声检验结果 -> 打印ARIMA模型准确性评价指标

![](picture/arima1.png#pic_center)
![](picture/arima2.png#pic_center)

```
                                      SARIMAX Results                                      
===========================================================================================
Dep. Variable:                                   y   No. Observations:                 1000
Model:             SARIMAX(2, 1, 1)x(2, 1, [], 30)   Log Likelihood               -2108.542
Date:                             Mon, 29 Aug 2022   AIC                           4229.085
Time:                                     22:29:38   BIC                           4258.342
Sample:                                          0   HQIC                          4240.222
                                            - 1000                                         
Covariance Type:                               opg                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
ar.L1          0.7687      0.047     16.275      0.000       0.676       0.861
ar.L2         -0.2145      0.025     -8.685      0.000      -0.263      -0.166
ma.L1         -0.7967      0.041    -19.250      0.000      -0.878      -0.716
ar.S.L30      -0.6301      0.024    -26.243      0.000      -0.677      -0.583
ar.S.L60      -0.3619      0.023    -16.052      0.000      -0.406      -0.318
sigma2         4.4711      0.154     28.984      0.000       4.169       4.773
===================================================================================
Ljung-Box (L1) (Q):                   0.04   Jarque-Bera (JB):               304.86
Prob(Q):                              0.84   Prob(JB):                         0.00
Heteroskedasticity (H):               0.45   Skew:                            -0.42
Prob(H) (two-sided):                  0.00   Kurtosis:                         5.61
===================================================================================
```
![](picture/arima3.png#pic_center)
![](picture/arima4.png#pic_center)
```
ARIMA:  {'MSE': 26.621762638482185, 'RMSE': 5.159628149245077, 'MAE': 3.945205074339352, 'MAPE': 0.21063328014251662}
```

## 4 天气预报系统
__示例：__ 直接运行`main2.py`文件，或将本程序在终端中打开，输入
```
python main2.py
```
可进入天气预报系统，通过下拉菜单选择城市和模型，点击`查询`按钮，可得到该城市未来7天的天气预报。\
点击`返回`按钮，可退回主界面重新选择。\
点击`退出`按钮，可退出天气预报系统。

![](picture/gui1.png#pic_center)
![](picture/gui2.png#pic_center)